{{- $work := false -}}
{{- $devtools := true -}}

{{- $_localBin := joinPath ".local" "bin" -}}
{{- $_localInstall := joinPath ".local" "opt" -}}
{{- $_localInstallBin := joinPath $_localInstall "bin" -}}
{{- $_localInstallSbin := joinPath $_localInstall "sbin" -}}
{{- $_dotnetTools := joinPath ".dotnet" "tools" -}}
{{- $_dataHome := joinPath ".local" "share" -}}
{{- $_configHome := ".config" -}}
{{- $_cacheHome := ".cache" -}}
{{- $_lunarvimRuntime := joinPath $_dataHome "lunarvim" -}}
{{- $_lunarvimConfig := joinPath $_configHome "lvim" -}}
{{- $_lunarvimCache := joinPath $_cacheHome "lvim" -}}
{{- $_lunarvimBase := joinPath $_lunarvimRuntime "lvim" -}}
{{- $_ipython := joinPath $_configHome "ipython" -}}
{{- $_cargoHome := joinPath $_localInstall "cargo" -}}
{{- $_relativePaths := dict
      "localBin" $_localBin
      "localInstall" $_localInstall
      "localInstallBin" $_localInstallBin
      "localInstallSbin" $_localInstallSbin
      "dotnetTools" $_dotnetTools
      "dataHome" $_dataHome
      "configHome" $_configHome
      "cacheHome" $_cacheHome
      "lunarvimRuntime" $_lunarvimRuntime
      "lunarvimConfig" $_lunarvimConfig
      "lunarvimCache" $_lunarvimCache
      "lunarvimBase" $_lunarvimBase
      "ipython" $_ipython
      "cargoHome" $_cargoHome
-}}
{{- $_platformRelativePaths := dict }}
{{- if eq "windows" .chezmoi.os -}}
{{-   $_scoop := joinPath $_localInstall "scoop" -}}
{{-   $_bash := joinPath $_scoop "apps" "git" "current" "bin" "bash.exe" }}
{{-   $_platformRelativePaths = dict
        "scoop" $_scoop
        "bash" $_bash
-}}
{{- else -}}
{{-   $_dotnetRoot := joinPath $_localInstall "dotnet" -}}
{{-   $_asdf := joinPath $_localInstall "asdf" -}}
{{-   $_asdfInstalls := joinPath $_asdf "installs" -}}
{{-   $_rustInstall := joinPath $_asdfInstalls "rust" "stable" -}}
{{-   $_platformRelativePaths = dict
        "dotnetRoot" $_dotnetRoot
        "asdf" $_asdf
        "asdfInstalls" $_asdfInstalls
        "rustInstall" $_rustInstall
-}}
{{- end -}}
{{- $_relativePaths = merge $_relativePaths $_platformRelativePaths }}
{{- $paths := dict -}}
{{- range $k, $v := $_relativePaths -}}
{{-   $paths = set $paths $k (joinPath $.chezmoi.homeDir $v) -}}
{{- end -}}
{{- $paths = set $paths "relative" $_relativePaths -}}

data:
  work: {{ $work }}
  devtools: {{ $devtools }}
  paths:
{{ $paths | toYaml | indent 4 }}
  environment:
    - name: AWS_PROFILE
      action: unset
    - name: KUBECONFIG
      action: unset
    - name: GPG_TTY
      action: command
      value: tty
    - name: IPYTHONDIR
      path: true
      value: {{ $paths.ipython }}
    - name: LOCAL_INSTALL_DIR
      path: true
      value: {{ $paths.localInstall }}
      export: false
{{- if ne "windows" .chezmoi.os }}
    - name: DOTNET_ROOT
      path: true
      value: {{ $paths.dotnetRoot }}
    - name: DOTNET_INSTALL_DIR
      path: true
      value: {{ $paths.dotnetRoot }}
{{- end }}
    - name: XDG_DATA_HOME
      path: true
      persist: true
      value: {{ $paths.dataHome }}
    - name: XDG_CONFIG_HOME
      path: true
      persist: true
      value: {{ $paths.configHome }}
    - name: XDG_CACHE_HOME
      path: true
      persist: true
      value: {{ $paths.cacheHome }}
    - name: LUNARVIM_RUNTIME_DIR
      path: true
      persist: true
      value: {{ $paths.lunarvimRuntime }}
    - name: LUNARVIM_CONFIG_DIR
      path: true
      persist: true
      value: {{ $paths.lunarvimConfig }}
    - name: LUNARVIM_CACHE_DIR
      path: true
      persist: true
      value: {{ $paths.lunarvimCache }}
    - name: LUNARVIM_BASE_DIR
      path: true
      persist: true
      value: {{ $paths.lunarvimBase  }}
    - name: CARGO_HOME
      path: true
      persist: true
      value: {{ $paths.cargoHome }}
{{- if eq "windows" .chezmoi.os }}
    - name: SCOOP
      path: true
      persist: true
      value: {{ $paths.scoop }}
{{- else }}
    - name: ASDF_DIR
      value: {{ $paths.asdf }}
    - name: ASDF_DATA_DIR
      value: {{ $paths.asdf }}
    - name: RUSTUP_HOME
      value: {{ $paths.rustInstall }}
{{- end }}
    - name: PATH
      path: true
      action: prepend
      persist: true
      value:
        - {{ $paths.localBin }}
        - {{ $paths.dotnetTools }}
        - {{ $paths.localInstallBin }}
{{- if ne "windows" .chezmoi.os }}
        - {{ $paths.dotnetRoot }}
{{- else }}
        - {{ joinPath .chezmoi.homeDir ".cargo" "bin" }}
{{- end }}

{{- if eq .chezmoi.os "windows" }}
interpreters:
  sh:
    command: {{ $paths.bash }}
  ps1:
    command: pwsh
    args:
      - "-NoLogo"
{{- end  }}
