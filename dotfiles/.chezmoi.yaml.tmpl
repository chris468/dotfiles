data:
{{- $_defaults := includeTemplate ".chezmoitemplates/configDefaults" (dict "chezmoi" .chezmoi "paths" (dict "configHome" "~/.config")) | fromYaml }}

{{- $_profile := "profile" | index . | default dict -}}
{{- $work := promptBoolOnce $_profile "work" "Work" false }}
    profile:
        work: {{ $work }}
        swapkeys: {{ "swapkeys" | index $_profile | default false }}

{{ $config := "config" | index . | default dict -}}

{{/* Check for old (the only legacy config I was likely to set) */ -}}
{{ if not ("config" | hasKey .) -}}
{{   $_legacy_ssh_hosts := "ssh_hosts" | index . -}}
{{   if $_legacy_ssh_hosts -}}
{{     $config = set $config "ssh_hosts" $_legacy_ssh_hosts -}}
{{   end -}}
{{   $_legacy_font_size := "size" | index ("font" | index . | default dict) -}}
{{   if and $_legacy_font_size (ne $_legacy_font_size $_defaults.font.size) -}}
{{     $config = set $config "font" (dict "size" $_legacy_font_size) }}
{{   end -}}
{{ end -}}

{{ dict "config" $config | toYaml | indent 4 }}

# ==============================================================================
# ==== Everything past this point is generated, changes will be overwritten ====
# ==============================================================================


{{ $realConfig := $config | mergeOverwrite $_defaults -}}

{{ $availableThemes := list
    "catppuccin-mocha"
    "catppuccin"
    "nord"
    "tokyonight-night"
-}}

{{ if not ($availableThemes | has $realConfig.theme) -}}
{{   fail (printf "Invalid theme '%s'. Available themes: %s." ($realConfig.theme) ($availableThemes | join ", ")) -}}
{{ end -}}

{{ $nvimFlavors := list
    "lvim"
    "nvim-custom"
    "astrovim"
-}}

{{ if and $realConfig.nvim.flavor (not ($nvimFlavors | has $realConfig.nvim.flavor)) -}}
{{   fail (printf "Invalid nvim flavor '%s'. Available flavors: %s, or unset for default." ($realConfig.nvim.flavor) ($nvimFlavors | join ", ")) -}}
{{ end -}}

{{ dict "realConfig" $realConfig | toYaml | indent 4 }}

    defaults:
{{ $_defaults | toYaml | indent 8 }}

umask: 0o022

{{- if eq .chezmoi.os "windows" }}
interpreters:
    sh:
        command: {{ joinPath "C:\\" "Program Files" "git" "bin" "bash.exe" }}
    ps1:
        command: pwsh
        args:
            - "-NoLogo"

    cd:
        command: pwsh
{{- end  }}
# vim: set ft=none syntax=yaml ts=4 sw=4 et :
