chezmoi:template:missing-key=zero
#!/usr/bin/env bash

# For first install, ensure that the paths are set.
. ~/.config/bash/bashrc.d/50-environment.bash

FAILED_TOOLS=

if ! command -v asdf &>/dev/null
then
  . ~/.asdf/asdf.sh
fi

function asdf-install {
  set -e
  name=$1 ; shift
  repo=$1 ; shift
  default_version=$1

  asdf plugin add $name $repo

  while [ $# -ne 0 ]
  do
    version=$1 ; shift
    asdf install $name $version
  done

  asdf global $name $default_version
}

function install-lunarvim {
  set -e
  LVIM_CONFIG="$HOME/.config/lvim"
  LVIM_CONFIG_BACKUP="$LVIM_CONFIG.bkp"
  if [ -d "$LVIM_CONFIG" ]
  then
    echo "Backing up $LVIM_CONFIG --> $LVIM_CONFIG_BACKUP"
    cp -a "$LVIM_CONFIG" "$LVIM_CONFIG_BACKUP"
  fi

{{- $versions := (includeTemplate "software" . | fromYaml).versions }}
  INSTALL_PREFIX="$HOME/.local/opt" LV_BRANCH={{ $versions.lunarvim }} ~/.local/opt/sbin/install-lunarvim.sh -y --install-dependencies

  if [ -d "$LVIM_CONFIG_BACKUP" ]
  then
    echo "Restoring $LVIM_CONFIG_BACKUP --> $LVIM_CONFIG"
    rm -rf "$LVIM_CONFIG"
    mv "$LVIM_CONFIG_BACKUP" "$LVIM_CONFIG"
  fi
}

function install-dotnet {
  set -e
  while [ $# -ne 0 ]
  do
    version=$1 ; shift
    ~/.local/opt/sbin/dotnet-install.sh --channel $version
  done
}
