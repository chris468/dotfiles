chezmoi:template:missing-key=zero

function Script:Prepend-Environment(
      [string]$name,
      [string[]]$values)
{
    $original=Get-Content Env:\$name
    $originalNormalized=@()
    foreach ($p in $original -split ";") {
        $originalNormalized += $p.ToUpper() -replace "/","\"
    }

    $prepend=""
    foreach ($p in $values) {
        if ($originalNormalized -notcontains ($p.ToUpper() -replace "/","\")) {
            $prepend += "$p;"
        }
    }

    if ($prepend) {
        Set-Content Env:\$name "$prepend$original"
    }
}

{{- includeTemplate "windows/set-environment" (dict
        "chezmoi" .chezmoi
        "set" "$env:$name=\"$value\""
        "unset" "Remove-Item Env:\\$name 2>&1 | Out-Null"
        "prepend" "Prepend-Environment $name $value")
-}}
