# Modify template at '{{ yadm.source }}'

oh_my_posh_version="10.3.0"

function __install_oh_my_posh {

    function download {
        curl -L -o ~/.local/bin/oh-my-posh${oh_my_posh_extension} $oh_my_posh_url -s
        chmod +x ~/.local/bin/oh-my-posh${oh_my_posh_extension}
    }

    oh_my_posh_extension=""

{% if yadm.os == "Msys" %}
    oh_my_posh_os="windows"
    oh_my_posh_extension=".exe"
{% else %}
{% if yadm.os == "WSL" %}
    oh_my_posh_os="linux"
{% else %}
    oh_my_posh_os="{{ yadm.os }}"
{% endif %}

{% if yadm.arch == "x86_64" %}
    oh_my_posh_arch="amd64"
{% else %}
    oh_my_posh_arch="{{ yadm.arch }}"
{% endif %}

    oh_my_posh_url=https://github.com/JanDeDobbeleer/oh-my-posh/releases/download/v$oh_my_posh_version/posh-$oh_my_posh_os-$oh_my_posh_arch${oh_my_posh_extension}

    if command -v oh-my-posh &> /dev/null
    then
        current_version="$(oh-my-posh version)"
        if [ "$oh_my_posh_version" != "$current_version" ]
        then
            echo "Updating oh-my-posh from version $current_version to $oh_my_posh_version..."
            download
        fi
    else
        echo "Installing oh-my-posh..."
        download
    fi
}

__install_oh_my_posh
